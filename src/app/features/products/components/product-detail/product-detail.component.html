<!-- product-detail.component.html -->
<div class="product-detail-page" *ngIf="product">
  <div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb-nav">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a routerLink="/">
            <i class="bi bi-house-door"></i> Inicio
          </a>
        </li>
        <li class="breadcrumb-item">
          <a routerLink="/">Productos</a>
        </li>
        <li class="breadcrumb-item active">{{ product.name }}</li>
      </ol>
    </nav>

    <!-- Product Main Section -->
    <div class="product-main">
      <!-- Gallery Section -->
      <div class="product-gallery">
        <!-- Main Image -->
        <div class="main-image-container">
          <span class="badge-condition">{{ product.condition }}</span>
          <img 
            [src]="selectedImage || product.image" 
            [alt]="product.name"
            class="main-image">
        </div>

        <!-- Thumbnails -->
        <div class="thumbnails-container" *ngIf="product.gallery && product.gallery.length > 1">
          <div class="thumbnails-scroll">
            <div 
              *ngFor="let img of product.gallery; let i = index"
              class="thumbnail"
              [class.active]="img === selectedImage"
              (click)="selectImage(img)">
              <img [src]="img" [alt]="product.name + ' - Imagen ' + (i + 1)">
            </div>
          </div>
        </div>
      </div>

      <!-- Product Info Section -->
      <div class="product-info-section">
        <!-- Title and Price -->
        <div class="product-header">
          <span class="product-category">
            <i class="bi bi-tag-fill"></i> {{ product.categoria }}
          </span>
          <h1 class="product-name">{{ product.name }}</h1>
          
          <!-- Rating -->
          <div class="product-rating">
            <div class="stars">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-half"></i>
            </div>
            <span class="rating-text">(4.5)</span>
          </div>

          <!-- Price -->
          <div class="price-section">
            <div class="current-price">
              {{ product.price | currency: 'CLP':'symbol':'1.0-0' }}
            </div>
          </div>
        </div>

        <!-- Product Meta Info -->
        <div class="product-meta">
          <div class="meta-item">
            <i class="bi bi-geo-alt-fill"></i>
            <div class="meta-content">
              <span class="meta-label">Ubicación</span>
              <span class="meta-value">{{ product.sucursal }}</span>
            </div>
          </div>
          
          <div class="meta-item">
            <i class="bi bi-box-seam"></i>
            <div class="meta-content">
              <span class="meta-label">Estado</span>
              <span class="meta-value">{{ product.condition }}</span>
            </div>
          </div>

          <div class="meta-item" *ngIf="product.usageDetails">
            <i class="bi bi-info-circle-fill"></i>
            <div class="meta-content">
              <span class="meta-label">Detalles de uso</span>
              <span class="meta-value">{{ product.usageDetails }}</span>
            </div>
          </div>
        </div>

        <!-- Description -->
        <div class="product-description">
          <h3>
            <i class="bi bi-text-left"></i> Descripción
          </h3>
          <p>{{ product.description || 'No hay descripción disponible para este producto.' }}</p>
        </div>

        <!-- Features -->
        <div class="product-features" *ngIf="product.features && product.features.length > 0">
          <h3>
            <i class="bi bi-check-circle-fill"></i> Características
          </h3>
          <ul>
            <li *ngFor="let feature of product.features">
              <i class="bi bi-check2"></i> {{ feature }}
            </li>
          </ul>
        </div>

        <!-- Actions -->
        <div class="product-actions">
          <button 
            class="btn-primary"
            [disabled]="isInCart"
            (click)="addToCart()">
            <i class="bi" [ngClass]="isInCart ? 'bi-cart-check-fill' : 'bi-cart-plus'"></i>
            {{ isInCart ? 'Ya está en el carrito' : 'Agregar al carrito' }}
          </button>

          <button 
            class="btn-secondary"
            (click)="reservar()">
            <i class="bi bi-bookmark-fill"></i>
            Reservar producto
          </button>

          <button 
            class="btn-outline"
            (click)="goBackToHome()">
            <i class="bi bi-arrow-left"></i>
            Volver al catálogo
          </button>
        </div>

        <!-- Important Notice -->
        <div class="important-notice">
          <i class="bi bi-exclamation-circle-fill"></i>
          <div>
            <strong>Importante:</strong> Todos los productos son usados y han sido evaluados por técnicos especializados. 
            La compra debe realizarse en la sucursal indicada en efectivo.
          </div>
        </div>
      </div>
    </div>

    <!-- Product Details Tabs -->
    <div class="product-tabs">
      <div class="tabs-header">
        <button 
          class="tab-button"
          [class.active]="activeTab === 'details'"
          (click)="activeTab = 'details'">
          <i class="bi bi-info-circle"></i> Detalles del Producto
        </button>
        <button 
          class="tab-button"
          [class.active]="activeTab === 'process'"
          (click)="activeTab = 'process'">
          <i class="bi bi-list-check"></i> Proceso de Compra
        </button>
      </div>

      <div class="tabs-content">
        <!-- Details Tab -->
        <div class="tab-panel" *ngIf="activeTab === 'details'">
          <div class="details-grid">
            <div class="detail-item">
              <span class="detail-label">Categoría:</span>
              <span class="detail-value">{{ product.categoria }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Estado:</span>
              <span class="detail-value">{{ product.condition }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Sucursal:</span>
              <span class="detail-value">{{ product.sucursal }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Código:</span>
              <span class="detail-value">#{{ product.id }}</span>
            </div>
          </div>
        </div>

        <!-- Process Tab -->
        <div class="tab-panel" *ngIf="activeTab === 'process'">
          <div class="process-steps">
            <div class="process-step">
              <div class="step-number">1</div>
              <div class="step-content">
                <h4>Reserva el producto</h4>
                <p>Haz clic en "Reservar producto" y completa el formulario con tus datos</p>
              </div>
            </div>
            <div class="process-step">
              <div class="step-number">2</div>
              <div class="step-content">
                <h4>Recibe tu código</h4>
                <p>Te enviaremos un código de reserva único por correo electrónico</p>
              </div>
            </div>
            <div class="process-step">
              <div class="step-number">3</div>
              <div class="step-content">
                <h4>Visita la sucursal</h4>
                <p>Acude a la sucursal con tu código antes del vencimiento de la reserva</p>
              </div>
            </div>
            <div class="process-step">
              <div class="step-number">4</div>
              <div class="step-content">
                <h4>Evalúa y compra</h4>
                <p>Revisa el producto presencialmente y realiza tu compra en efectivo</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Related Products -->
    <section class="related-products" *ngIf="recommendedProducts && recommendedProducts.length > 0">
      <div class="section-header">
        <h2>
          <i class="bi bi-grid-3x3-gap-fill"></i> Productos Relacionados
        </h2>
        <p>Otros productos que podrían interesarte</p>
      </div>
      <app-carousel-products
        [products]="recommendedProducts"
        carouselId="CarouselRelatedProducts">
      </app-carousel-products>
    </section>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading && !product">
  <div class="spinner"></div>
  <p>Cargando producto...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <i class="bi bi-exclamation-triangle-fill"></i>
  <h2>{{ error }}</h2>
  <p>No pudimos cargar la información del producto solicitado.</p>
  <button class="btn-primary" routerLink="/">
    <i class="bi bi-house-door"></i> Volver al inicio
  </button>
</div>